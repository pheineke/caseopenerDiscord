{% extends 'base.html' %}
{% block title %}Profile Settings{% endblock %}
{% block content %}
<h1 style="font-size:1rem;margin:0 0 1rem;">Profile Settings</h1>
<form method="post" enctype="multipart/form-data" class="stack" style="--gap:1.2rem;">
  <div class="surface" style="padding:1rem;display:flex;flex-direction:row;gap:1.25rem;align-items:flex-start;flex-wrap:wrap;">
    <div style="display:flex;gap:1.25rem;align-items:flex-start;">
      <div style="display:flex;flex-direction:column;align-items:center;gap:.6rem;">
        <img src="{{ avatar_url(user) }}" alt="Avatar" style="width:110px;height:110px;border-radius:50%;object-fit:cover;border:2px solid #2f4761;">
      </div>
      <div class="stack" style="--gap:.6rem;min-width:220px;">
        <div class="stack" style="--gap:.4rem;">
          <label style="font-size:.6rem;letter-spacing:1px;text-transform:uppercase;opacity:.6;">Change Avatar</label>
          <input type="file" name="avatar_file" accept="image/png,image/jpeg,image/webp,image/svg+xml" style="font-size:.65rem;">
          <div class="text-dim" style="font-size:.55rem;line-height:1.3;">PNG, JPG, WEBP or SVG. Max 512KB. Leave empty to keep current.</div>
        </div>
      </div>
    </div>
  </div>
  <div class="surface" style="padding:1rem;display:flex;flex-direction:column;gap:.9rem;">
    <div class="stack" style="--gap:.75rem;">
      <label style="display:flex;align-items:center;gap:.6rem;font-size:.8rem;">
        <input type="checkbox" name="public_enabled" {% if user.public_enabled %}checked{% endif %}> Enable Public Profile
      </label>
      <div class="stack" style="--gap:.4rem;max-width:380px;">
        <label style="font-size:.6rem;letter-spacing:1px;text-transform:uppercase;opacity:.6;">Public URL Slug</label>
        <input name="public_slug" value="{{ user.public_slug or '' }}" placeholder="your-name" style="padding:.5rem .6rem;background:#1d2738;border:1px solid #2f4761;border-radius:6px;color:var(--text-color);">
        <div class="text-dim" style="font-size:.6rem;">Final URL: <code>/u/&lt;slug&gt;</code> (allowed: a-z 0-9 _ - , 3-32 chars). Leave blank to auto-generate.</div>
        <div id="slugPreview" style="font-size:.55rem;opacity:.65;"></div>
      </div>
    </div>
  </div>
  <div class="surface" style="padding:1rem;">
    <div style="font-size:.65rem;letter-spacing:1px;text-transform:uppercase;opacity:.7;margin:0 0 .75rem;">Showcase Items (max 12)</div>
    <div class="row" style="flex-wrap:wrap;gap:.6rem;">
      {% for it in inventory %}
        <label class="surface showcase-option" style="padding:.55rem .6rem;display:flex;flex-direction:column;align-items:center;gap:.45rem;flex:0 0 110px;cursor:pointer;position:relative;user-select:none;">
          <input type="checkbox" name="showcase_item" value="{{ it.item_id }}" {% if it.item_id in selected_ids %}checked{% endif %} style="display:none;">
          {% if it.image %}<img src="/{{ it.image.lstrip('/') }}" alt="{{ it.name }}" style="width:64px;height:64px;object-fit:cover;border-radius:8px;transition:transform .25s;">{% else %}<div style="width:64px;height:64px;border:1px dashed #2f4761;border-radius:8px;"></div>{% endif %}
          <div style="font-size:.55rem;font-weight:600;text-align:center;line-height:1.1;">{{ it.name }}</div>
          <div style="font-size:.5rem;opacity:.6;">x{{ it.quantity }}</div>
        </label>
      {% endfor %}
    </div>
  </div>
  <button class="btn btn-primary" style="align-self:flex-start;">Save</button>
</form>
<script>
const slugInput = document.querySelector('input[name="public_slug"]');
const preview = document.getElementById('slugPreview');
function randSuggestion(){
  const chars='abcdefghijklmnopqrstuvwxyz0123456789';
  let s=''; for (let i=0;i<8;i++) s+=chars[Math.floor(Math.random()*chars.length)];
  return s;
}
function updatePreview(){
  const v = slugInput.value.trim();
  if (v) {
    preview.textContent = 'Preview: /u/' + v;
  } else {
    preview.textContent = 'Will auto-generate (example: /u/' + randSuggestion() + ')';
  }
}
slugInput.addEventListener('input', updatePreview);
updatePreview();

// Showcase selection: neon border on selection
const showcaseCards = document.querySelectorAll('.showcase-option');
function syncShowcase(card){
  const cb = card.querySelector('input[type="checkbox"]');
  if (cb.checked) {
    card.classList.add('selected');
  } else {
    card.classList.remove('selected');
  }
}
showcaseCards.forEach(card => {
  const cb = card.querySelector('input[type="checkbox"]');
  syncShowcase(card);
  card.addEventListener('click', () => {
    // allow label default toggle then sync
    setTimeout(()=>syncShowcase(card),0);
  });
});
</script>
<style>
.showcase-option { border:1px solid #2f4761; transition:border-color .25s, box-shadow .25s, transform .25s; }
.showcase-option:hover { border-color:#3fa9f5; }
.showcase-option.selected { border-color: var(--color-primary-accent); box-shadow:0 0 0 1px rgba(63,169,245,.65),0 0 6px 2px rgba(63,169,245,.35),0 0 16px -2px rgba(63,169,245,.55); }
.showcase-option.selected img { transform:scale(1.05); }
.showcase-option:active { transform:translateY(1px); }
</style>
{% endblock %}
